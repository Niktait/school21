# Отчет по заданию DevOps

## Часть 1: Сети и маски

### 1.1 Определение сетевого адреса

- **Задача:** Определить сетевой адрес для IP-адреса `192.167.38.54/13`.
- **Решение:** Для определения сетевого адреса использован инструмент `ipcalc`.
- **Команда:**
  ipcalc 192.167.38.54/13
![Описание скриншота](\images\ipcalc.png)


### 2. Преобразование маски 255.255.255.0
- **Обычная форма:** 255.255.255.0
- **Префиксная форма:** /24
- **Двоичная форма:** 11111111.11111111.11111111.00000000
![Описание скриншота](\images\ipcalc255.png)

### 3. Преобразование маски /15
- **Префиксная форма:** /15
- **Обычная форма:** 255.254.0.0
- **Двоичная форма:** 11111111.11111110.00000000.00000000
![Описание скриншота](\images\ipcalc15.png)

### 4. Преобразование маски 11111111.11111111.11111111.11110000
- **Двоичная форма:** 11111111.11111111.11111111.11110000
- **Обычная форма:** 255.255.255.240
- **Префиксная форма:** /28
![Описание скриншота](\images\ipcalc28.png)

### 5. Минимальный и максимальный хост в сети 12.167.38.4 с масками: /8, 1111111111.11111111.00000000.00000000, 255.255.254.0 и /4
![Описание скриншота](\images\ipcalc48.png)

### 6. 1111111111.11111111.00000000.00000000
![Описание скриншота](\images\ipcalc16.png)

### 7 . 255.255.254.0
![Описание скриншота](\images\254.png)

### 8 . /4
![Описание скриншота](\images\4.png)


## 1.2 Локальный хостинг
- **Задача:** Определить, можно ли получить доступ к приложению, запущенному на `localhost`, со следующих IP-адресов:
  - `194.34.23.100` не доступен в локальной сети.
  - `127.0.0.2` `127.1.0.1` доступны в локальной сети
  - `128.0.0.1` не доступен в локальной сети
![Описание скриншота](\images\dostup.png)

## 1.3. Диапазоны и сегменты сети

- **Задача:** Определить, какой из перечисленных IP-адресов может использоваться как общедоступный, а какой только как частный.

#### IP-адреса:

1. **10.0.0.45**
   - **Тип:** Частный
   - **Диапазон:** 10.0.0.0/8
   - **Комментарий:** Этот адрес попадает в диапазон частных IP-адресов.

2. **134.43.0.2**
   - **Тип:** Общедоступный
   - **Комментарий:** Этот адрес не попадает в диапазоны частных IP-адресов.

3. **192.168.4.2**
   - **Тип:** Частный
   - **Диапазон:** 192.168.0.0/16
   - **Комментарий:** Этот адрес попадает в диапазон частных IP-адресов.

4. **172.20.250.4**
   - **Тип:** Частный
   - **Диапазон:** 172.16.0.0/12
   - **Комментарий:** Этот адрес попадает в диапазон частных IP-адресов.

5. **172.0.2.1**
   - **Тип:** Общедоступный
   - **Комментарий:** Этот адрес находится в диапазоне адресов, зарезервированных для документации и примеров (RFC 5737), и не используется в реальных частных сетях.

6. **192.172.0.1**
   - **Тип:** Общедоступный
   - **Комментарий:** Этот адрес находится вне диапазона частных IP-адресов.

7. **172.68.0.2**
   - **Тип:** Общедоступный
   - **Комментарий:** Этот адрес не попадает в диапазон частных IP-адресов.

8. **172.16.255.255**
   - **Тип:** Частный
   - **Диапазон:** 172.16.0.0/12
   - **Комментарий:** Этот адрес попадает в диапазон частных IP-адресов.

9. **10.10.10.10**
   - **Тип:** Частный
   - **Диапазон:** 10.0.0.0/8
   - **Комментарий:** Этот адрес попадает в диапазон частных IP-адресов.

10. **192.169.168.1**
    - **Тип:** Общедоступный
    - **Комментарий:** Этот адрес находится вне диапазона частных IP-адресов.

- **Частные IP-адреса** предназначены для использования внутри частных сетей и не маршрутизируются в интернете.
- **Общедоступные IP-адреса** могут использоваться в интернете и видны за пределами частной сети.


2) какие из перечисленных IP-адресов шлюза возможны для сети 10.10.0.0/18: 10.0.0.1, 10.10.0.2, 10.10.10.10, 10.10.100.1, 10.10.1.255
![Описание скриншота](\images\018.png)

**Находятся в диапазоне:**
- 10.10.0.2
- 10.10.10.10
- 10.10.1.255

**Не находятся в диапазоне:**
- 10.0.0.1
- 10.10.100.1

- **Диапазон сети:** `10.10.0.0/18` охватывает адреса от `10.10.0.0` до `10.10.63.255`.





## Часть 2: Статическая маршрутизация между двумя машинами

### 1 Просмотр существующих сетевых интерфейсов

- **Задача:** Просмотреть существующие сетевые интерфейсы на обеих виртуальных машинах.
- **Команда:** `ip a`
- **Скриншот:** Добавьте скриншот вызова команды `ip a` и вывода на обеих машинах.
  - Скриншот для ws1:
    ![Скриншот интерфейсов ws1](\images\ws1.png)
    *На скриншоте показан вывод команды `ip a` для машины ws1.*

  - Скриншот для ws2:
    ![Скриншот интерфейсов ws2](\images\ws2.png)
    *На скриншоте показан вывод команды `ip a` для машины ws2.*

### 2 Настройка сетевых интерфейсов

- **Задача:** Настроить сетевые интерфейсы на обеих машинах с указанными адресами и масками.
  - **ws1:** IP-адрес `192.168.100.10`, маска `/16`
  - **ws2:** IP-адрес `172.24.116.8`, маска `/12`
- **Изменение конфигурации:** Обновите файл `/etc/netplan/00-installer-config.yaml` на обеих машинах.

- **Скриншот:** Добавьте скриншот измененного файла конфигурации `/etc/netplan/00-installer-config.yaml` для каждой машины.
  - Скриншот для ws1:
    ![Измененный файл конфигурации ws1](\images\netplan_ws1.png)
    *На скриншоте показан измененный файл `/etc/netplan/00-installer-config.yaml` для машины ws1.*

  - Скриншот для ws2:
    ![Измененный файл конфигурации ws2](\images\netplan_ws2.png)
    *На скриншоте показан измененный файл `/etc/netplan/00-installer-config.yaml` для машины ws2.*

### 3 Применение конфигурации

- **Задача:** Применить измененные настройки сетевых интерфейсов.
- **Команда:** `sudo netplan apply`
- **Скриншот:** Добавьте скриншот вызова команды `sudo netplan apply` и вывода на обеих машинах.
  - Скриншот для ws1:
    ![Скриншот выполнения netplan для ws1](\images\netplan_apply_ws1.png)
    *На скриншоте показан вывод команды `sudo netplan apply` для машины ws1.*

  - Скриншот для ws2:
    ![Скриншот выполнения netplan для ws2](\images\netplan_apply_ws2.png)
    *На скриншоте показан вывод команды `sudo netplan apply` для машины ws2.*

## Часть 2.1: Добавление статического маршрута вручную

### 2.1.1 Настройка маршрута на ws1

- **Команда:** `sudo ip route add 172.16.0.0/12 via 192.168.100.10`
- **Описание:** Добавлен маршрут к сети `172.16.0.0/12` через шлюз `192.168.100.10` на **ws1**.
- **На ws1:** Пропингован IP-адрес **ws2**: `ping 172.24.116.8`
![Маршрут на ws1](\images\route_ws1.png)

### 2.1.2 Настройка маршрута на ws2

- **Команда:** `sudo ip route add 192.168.0.0/16 via 172.24.116.8`
- **Описание:** Добавлен маршрут к сети `192.168.0.0/16` через шлюз `172.24.116.8` на **ws2**.
- **На ws2:** Пропингован IP-адрес **ws1**: `ping 192.168.100.10`
![Маршрут на ws2](\images\route_ws2.png)


## Часть 2: Статическая маршрутизация между двумя машинами

### 2.2 Добавление статического маршрута с сохранением

- **Задача:** Добавить статический маршрут от одной машины к другой с помощью файла `/etc/netplan/00-installer-config.yaml`.
- **Решение:** Настроены файлы `/etc/netplan/00-installer-config.yaml` на обеих машинах для добавления статических маршрутов.

#### Измененный файл конфигурации на ws1:
![Скриншот файла конфигурации ws1](\images\ws1_netplan.png)

#### Измененный файл конфигурации на ws2:
![Скриншот файла конфигурации ws2](\images\ws2_netplan.png)

- **Проверка соединения:** Пропингованы машины между собой.

#### Пинг с ws1 на ws2:
![Скриншот пинга с ws1 на ws2](\images\ping_ws1_to_ws2.png)

#### Пинг с ws2 на ws1:
![Скриншот пинга с ws2 на ws1](\images\ping_ws2_to_ws1.png)



## Часть 3: Измерение скорости соединения с помощью iperf3

### 3.2 Утилита iperf3

- **Задача:** Измерить скорость соединения между ws1 и ws2 с использованием утилиты iperf3.
- **Решение:** Установлен и запущен iperf3 на обеих машинах. На ws2 запущен сервер, на ws1 выполнен тест в режиме клиента.

#### Запуск сервера iperf3 на ws2:
![Скриншот запуска сервера на ws2](\images\iperf3_server_ws2.png)

#### Запуск клиента iperf3 на ws1:
![Скриншот запуска клиента на ws1 и результаты теста](\images\iperf3_client_ws1.png)



## Часть 4: Сетевой экран

### 4.1 Утилита iptables



- **Создание и содержимое файла ws1 /etc/firewall.sh:**
![Содержимое файла firewall.sh](\images\firewallshws1.png)

- **Запуск файла и проверка правил iptables ws1 /etc/firewall.sh:**
![Запуск и проверка правил firewall.sh](\images\firewallws1.png)

- **Создание и содержимое файла ws2 /etc/firewall.sh:**
![Содержимое файла firewall.sh](\images\firewallshws2.png)

- **Запуск файла и проверка правил iptables ws2 /etc/firewall.sh:**
![Запуск и проверка правил firewall.sh](\images\firewallws2.png)



## Часть 4: Сетевой экран

### 4.2 Утилита nmap

- **Поиск машины, которая не пингуется:**

- **ping -c 4 <IP-адрес>**
![ Результаты команды ping](\images\noping.png)

- **Запуск sudo nmap -p 22,80 <IP-адрес>**
![Результаты команды nmap](\images\hostup.png)


## Часть 5: Статическая маршрутизация сети

![Создал 5 машин 3 рабочие и 2 роутера](\images\5VM.png)

## 5.1. Настройка адресов машин
 **Содержание файла etc/netplan/00-installer-config.yaml для каждой машины:**
 ![ws11](\images\ws11y.png)
 ![ws21](\images\ws21y.png)
 ![ws22](\images\ws22y.png)
 ![r1](\images\r1y.png)
 ![r2](\images\r2y.png)

 **Перезапуск сервиса сети и проверка адреса машин (ip -4 a):**

 ![ws11](\images\ws11-4.png)
 ![ws21](\images\ws21-4.png)
 ![ws22](\images\w22-4.png)
 ![r1](\images\r1-4.png)
 ![r2](\images\r2-4.png)
 

 **Пропингуем ws22 с ws21:**
 ![ping 21 с ws 22](\images\ping21-22.png)

 **Пропингуем r1 с ws11:**
 ![ping r1 с ws 11](\images\ping1-11.png)


### 5.2 Включение переадресации IP-адресов

- **Задача:** Включить IP-переадресацию на роутерах для обеспечения маршрутизации между сетями.

#### Временное включение IP-переадресации

**Включение переадресации IP на роутерах с помощью команды sysctl -w net.ipv4.ip_forward=1:**

![r1sys](\images\r1sys.png)

![r2sys](\images\r2sys.png)

**Файл /etc/sysctl.conf с добавленной строкой net.ipv4.ip_forward = 1:**

![r1 nano](\images\r1nano.png)

![r2 nano](\images\r2nano.png)


### 5.3. Установка маршрута по умолчанию

**Добавим gateway4 [ip роутера] в файлы конфигураций рабочих станций, перезапустим сервис сети и вызовем команду ip r:**

![w11 gateway](\images\w11g.png)

![w21 gateway](\images\w21g.png)

![w22 gateway](\images\w22g.png)

**Пропингуем с ws11 роутер r2 и покажем на r2, что пинг доходит с помощью команды tcpdump -tn -i eth1:**

![ping ws11 на r2](\images\ws11r2.png)

### 5.4. Добавление статических маршрутов
**Добавим в роутеры r1 и r2 статические маршруты в файле конфигураций, перезапустим сервис сети и вызовем команду ip r:**

![назначение статических маршрутов на r1 и r2](\images\r1r2.png)

**Вызов команд ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0 на ws11:**

![проверка адресов с ws11 ws11 ](\images\ipws11.png)

**Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, поскольку он является адресом сети и доступен без шлюза.**


## Часть 5: Статическая маршрутизация сети

### 5.5 Составление списка маршрутизаторов

**Задача:** Использовать утилиту `traceroute` для составления списка маршрутизаторов на пути от ws11 к ws21, а также проанализировать дамп трафика на роутере r1.

#### Шаг 1: Запуск tcpdump на r1
sudo tcpdump -tnv -i enp0s3
![проверка адресов с ws11 ws11 ](\images\r1tc.png)

![tracerout 10.20.0.10 ](\images\tcpd.png)


Объяснение работы traceroute
Утилита traceroute отправляет пакеты с постепенно увеличивающимся значением поля TTL (Time to Live) в заголовке IP-пакета. Каждый маршрутизатор на пути уменьшает TTL на 1. Если TTL достигает 0, маршрутизатор отбрасывает пакет и отправляет сообщение об ошибке ICMP (Time Exceeded) обратно к источнику.

Анализ дампа на r1:

При просмотре дампа с помощью tcpdump, можно наблюдать ICMP-пакеты, которые передаются между узлами. В выводе tcpdump на r1 видно, как пакеты проходят через интерфейс enp0s8, когда traceroute отправляет запросы от ws11 к ws21.

Эти пакеты включают запросы от ws11 к следующему маршрутизатору (r1) и ответы ICMP от r1 обратно к ws11, подтверждая, что r1 был одним из маршрутизаторов на пути. Затем traceroute повторяет процесс с увеличенным TTL, и маршрут продолжается через r2 к ws21.

Таким образом, traceroute последовательно выявляет каждый маршрутизатор на пути к целевому узлу, и мы можем наблюдать эти шаги в выводе tcpdump на r1.


## Часть 5: Статическая маршрутизация сети

### 5.6 Использование протокола ICMP при маршрутизации

- **Запуск на r1 перехвата сетевого трафика, проходящего через eth0 с помощью команды tcpdump -n -i eth0 icmp и пинг с ws11 несуществующего IP ping -c 1 10.30.0.111:**

  sudo tcpdump -n -i eth0 icmp

![ICMP ](\images\loss.png)

## Part 6. Динамическая настройка IP с помощью DHCP
**Содержание файла /etc/dhcp/dhcpd.conf для r2 с конфигурацией службы DHCP:**
![dhcp.conf ](\images\dhcpr2.png)

**Содержание файла resolv.conf с nameserver 8.8.8.8.:**

![resolv.conf ](\images\r2res.png)

**Перезагрузка службы DHCP командой systemctl restart isc-dhcp-server:**

![systemctl ](\images\r2restart.png)

**Перезагружаем машину ws21 при помощи reboot и через ip a покажем, что она получила адрес:**
![ws21reboot ip a ](\images\ws21restart.png)

**Пинг ws22 с ws21:**
![pinws22 c ws21 ](\images\ping2221.png)

**Cодержание файла etc/netplan/00-installer-config.yaml для ws11 с добавленным MAC адресом:**
![macws11 ](\images\macws11.png)

**Аналогичная настройка r1 (с жесткой привязкой к MAC адресу)**
Конфигурация DHCP:

![r1 ](\images\r1mac.png)

**DNS:**

![DNS ](\images\dns.png)

**Перезагрузка службы DHCP:**

![Dhcp ](\images\dhcp.png)

**Запрос обновления ip адреса с ws21**
ip до обновления:

![ip до  ](\images\ws21do.png)

**ip после обновления:**

![ip после  ](\images\ws21posle.png)

Команда sudo dhclient -r enp0s3 освобождает текущий адрес интерфейса enp0s3. Команда sudo dhclient enp0s3 задает новый адрес указанному интерфейсу.

## Часть 7. Настройка NAT

### 1. Настройка веб-серверов Apache на ws22 и r1

#### 1.1 Изменение конфигурации Apache

- **Файл /etc/apache2/ports.conf:**

  ![Измененный файл ports.conf на ws22 r2](\images\ws22r2.png)


#### 1.2 Запуск веб-сервера Apache

- **Запуск сервера Apache на ws22 и r1:**

  ![Команда запуска Apache на ws22 r1](\images\ws22e1ap.png)
 

### 2. Настройка брандмауэра на r2

1) Удаление правил в таблице filter — iptables -F;

2) Удаление правил в таблице «NAT» — iptables -F -t nat;

3) Отбрасывать все маршрутизируемые пакеты — iptables --policy FORWARD DROP

#### 2.1 Очистка правил

- **Очистка правил iptables:**

  ![Очистка iptables](\images\chr2.png)

#### 2.2 Проверка соединения между ws22 и r1

- **Пинг ws22 с r1 (неудачный):**

  ![Пинг ws22 с r1](\images\ping_fail.png)

### 3. Добавление правил для ICMP, SNAT и DNAT

#### 3.1 Разрешение маршрутизации ICMP

- **Пинг ws22 с r1 (успешный):**

  ![Пинг ws22 с r1](\images\ping_success.png)

#### 3.2 Включение SNAT

- **Добавление правила SNAT:**

  ![Правило SNAT](\images\snat_rule.png)

#### 3.3 Включение DNAT

- **Добавление правила DNAT:**

  ![Правило DNAT](\images\dnat_rule.png)

### 4. Проверка соединений

#### 4.1 Проверка SNAT

- **Подключение к Apache на r1 с ws22:**

Проверка соединения по TCP для SNAT, для этого с ws22 подключиться к серверу Apache на r1 командой telnet [адрес] [порт]:

  ![SNAT соединение](\images\snat_connection.png)

#### 4.2 Проверка DNAT

- **Подключение к Apache на ws22 с r1 через r2:**

Проверка соединения по TCP для DNAT, для этого с r1 подключиться к серверу Apache на ws22 командой telnet (обращаться по адресу r2 и порту 8080):

  ![DNAT соединение](\images\dnat_connection.png)



### Part 8. Дополнительно. Знакомство с SSH Tunnels

## Часть 1: Запуск фаервола на r2

1. **Запуск фаервола на `r2`**

![fire2](\images\fire2.png)

2. **Запуск веб-сервера Apache на ws22 только на localhost:**

![localhost](\images\lis80.png)

3. **Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21:**

![ws21tcp](\images\ws21tcp.png)

**Проверка подключения:**

![tel21](\images\tel21.png)

4. **Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11:**

![tunnws11](\images\tunnws11.png)

**Проверка подключения:**

![ws111](\images\ws111.png)